<!DOCTYPE>
<html>
<head>
	<link href="../static/crikit.css" rel="stylesheet">
</head>

<body>
	<!-- test line -->
	<div id="test_box"> </div>
	
	<div id="start_chirp_div">
		<br><br><br><br><br><br>
		<form action="/chirp">
			<input type="radio" class ="choice" name="user_choice" value="use_user_location"> Get temperature for my location
			<br><br>
			<input type="radio" class ="choice" name="user_choice" value="use_user_temp">
			<input type="text" name="user_temp" id="temp_input"> Use this temperature
			<br><br>
			<input type="submit" id="start_chirping_button" value="Chirp">
		</form>
	</div>

	<div id="stop_chirp_div">
		<br><br><br><br><br><br><br><br><br><br>
		<form action="/crikit">
			<input type="submit" id="stop_chirping_button" value="Stop Chirping">
		</form>
		
		<!-- test lines -->
		<!-- <p>{{ chirp_time }} between each chirp</p> -->
	</div>

	<ul>
		{% for message in get_flashed_messages() %}
			<li> {{ message }} </li>
		{% endfor %}
	</ul>

</body>
<script src="https://code.jquery.com/jquery.js"> </script>
<script src="https://code.createjs.com/soundjs-0.6.1.min.js"></script>
<!-- <script src="/static/crickit.js"></script> -->


<script>
// Makes js wait until DOM is loaded to execute (allows sound to load)
// function closed/finished at end of script
//s$(document).ready(function(){


// assigns variables to elements
var start_chirp = document.getElementById("start_chirp_div");
var stop_chirp = document.getElementById("stop_chirp_div");
var stop_button = document.getElementById("stop_chirping_button");
var start_button = document.getElementById("start_chirping_button");
// needed for sound.js
var soundPath = "static/crikit_chirp.mp3"
var soundID = "Chirp";
var keep_chirping = true;

// sets initial state for site
$(start_chirp).show();
$(stop_chirp).hide();

// Calls appropriate function for button clicks.
$("#start_chirping_button").on('click', startChirping);
$("#stop_chirping_button").on('click', stopChirping);

function loadSound() {
	createjs.Sound.registerSound(soundPath, soundID);
};


function changeChirp(evt) { 
	//doesn't submit form, hides stop and shows start. 

	// test:
	console.log("changeChirp() runs");
	//playSound();
	// don't submit form
	evt.preventDefault();

	// toggle which div shows on site
	$(start_chirp).toggle();
	$(stop_chirp).toggle();
};


function startChirping(evt) {
	//Passes user input to .py, calls makeChirp on results
	
	changeChirp(evt);
	loadSound();
	// test:
	console.log("re-enters startChirping");

	// Sets path to chirp with variables from html form
	var url = "/chirp?" + $("form").serialize();

	// test: prints out url to console
	console.log("user info url: " + url);

	// SHOULD pass url to server, then call makeChirps() on resulting info. Doesn't recognize results?
	// $.get(url, makeChirps(results));
	// Using an anonymous function that calls makeChirp works. Hm.
	$.get(url, function (results) {
		makeChirps(results);
	});

};


function playSound() {
		createjs.Sound.play(soundID);
		console.log("chirp");
};


function makeChirps(chirp_time_string) {
	// Takes in a time between chirps, and chirps at that interval. Returns nothing.

	// test: 
	console.log("got into makeChirps");
	console.log(chirp_time_string);

	chirp_time = Number(chirp_time_string);

	// setInterval(playSound, chirp_time);
		setInterval(function() {
			playSound();
		}, chirp_time);
};


function stopChirping(evt) { 
	// stop chirping and return to start page.

	changeChirp(evt);

	// Will need to stop chirping, too.
	// clearInterval(chirping);
	keep_chirping = false;

};

// FUNCTION GRAVEYARD (testing functions/other ideas)


// function setWorks() {
// 	console.log("setInterval is setting");
// };

// ayk's suggestion on http://stackoverflow.com/questions/5484205/call-function-with-setinterval-in-jquery
// function test(chirp_time) {
// 	console.log("test called");
// 	setTimeout(test, chirp_time);
// };

// closing docready
//});

</script>

</html>